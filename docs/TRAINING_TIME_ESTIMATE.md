# 训练时间估算 (Training Time Estimate)

## 📊 基于实际训练日志的估算

### 实际观测数据（LSTM 训练时间）
从 `experiments/A/lstm/raw/training_root.log` 观测：
- **3h horizon**: 48.01 分钟
- **6h horizon**: 53.66 分钟  
- **12h horizon**: 33.04 分钟
- **24h horizon**: 38.77 分钟
- **总计 4 个 horizon**: 173.49 分钟 ≈ **2.9 小时**

每个 horizon 包含：
- 分类模型训练（frost_classifier）
- 回归模型训练（temp_regressor）
- 评估和可视化

---

## 🎯 完整任务清单

### 1. 模型类型（10 个）
1. **LightGBM** - 树模型（快速）
2. **XGBoost** - 树模型（快速）
3. **CatBoost** - 树模型（快速）
4. **Random Forest** - 树模型（中等）
5. **Ensemble** - 集成模型（需要先训练3个模型）
6. **LSTM** - 深度学习（慢）
7. **LSTM Multitask** - 深度学习（中等，单模型）
8. **GRU** - 深度学习（慢）
9. **TCN** - 深度学习（慢）
10. **Prophet** - 时间序列（中等）

### 2. Horizon（4 个）
- 3h, 6h, 12h, 24h

### 3. Matrix Cells（5 个）
- **A**: Raw + 单站
- **B**: FE + 单站
- **C**: Raw + 多站（手工聚合）
- **D**: FE + 多站
- **E**: Raw + 多站（图神经网络，暂未实现）

### 4. Track（2 个）
- **raw**: A, C, E
- **top175_features**: B, D

### 5. 每个 Horizon 的模型数量
- **普通模型**: 2 个（分类 + 回归）
- **Multitask 模型**: 1 个（同时预测两个任务）

### 6. LOSO 评估
- 18 个站点
- 每个站点需要重新训练

---

## ⏱️ 单次训练时间估算（每个 horizon）

| 模型类型 | 分类模型 | 回归模型 | 总计/ Horizon | 备注 |
|---------|---------|---------|--------------|------|
| **LightGBM** | 3-5 分钟 | 3-5 分钟 | **6-10 分钟** | 树模型，快速 |
| **XGBoost** | 3-5 分钟 | 3-5 分钟 | **6-10 分钟** | 树模型，快速 |
| **CatBoost** | 4-6 分钟 | 4-6 分钟 | **8-12 分钟** | 树模型，快速 |
| **Random Forest** | 5-8 分钟 | 5-8 分钟 | **10-16 分钟** | 树模型，中等 |
| **Ensemble** | 15-20 分钟 | 15-20 分钟 | **30-40 分钟** | 需要先训练3个模型 |
| **LSTM** | 8-12 分钟 | 14-18 分钟 | **40-50 分钟** | 深度学习，慢（实际观测：~45分钟） |
| **LSTM Multitask** | - | - | **30-40 分钟** | 单模型，双任务 |
| **GRU** | 8-12 分钟 | 14-18 分钟 | **40-50 分钟** | 深度学习，慢 |
| **TCN** | 10-15 分钟 | 15-20 分钟 | **45-55 分钟** | 深度学习，慢 |
| **Prophet** | 8-12 分钟 | 8-12 分钟 | **16-24 分钟** | 时间序列模型 |

---

## 📈 完整训练时间计算

### 场景 1：核心模型（A/B 矩阵，单站）

#### 1.1 树模型（LightGBM, XGBoost, CatBoost, Random Forest）
- **模型数**: 4 个
- **Horizon**: 4 个
- **Matrix Cells**: A, B（2 个）
- **每个 horizon 时间**: 平均 10 分钟
- **计算**: 4 模型 × 4 horizon × 2 cells × 10 分钟 = **320 分钟 ≈ 5.3 小时**

#### 1.2 Ensemble
- **模型数**: 1 个
- **Horizon**: 4 个
- **Matrix Cells**: A, B（2 个）
- **每个 horizon 时间**: 35 分钟
- **计算**: 1 × 4 × 2 × 35 = **280 分钟 ≈ 4.7 小时**

#### 1.3 深度学习模型（LSTM, GRU, TCN）
- **模型数**: 3 个
- **Horizon**: 4 个
- **Matrix Cells**: A（raw track only）
- **每个 horizon 时间**: 45 分钟
- **计算**: 3 × 4 × 1 × 45 = **540 分钟 ≈ 9 小时**

#### 1.4 LSTM Multitask
- **模型数**: 1 个
- **Horizon**: 4 个
- **Matrix Cells**: A（raw track only）
- **每个 horizon 时间**: 35 分钟
- **计算**: 1 × 4 × 1 × 35 = **140 分钟 ≈ 2.3 小时**

#### 1.5 Prophet
- **模型数**: 1 个
- **Horizon**: 4 个
- **Matrix Cells**: A（raw track only）
- **每个 horizon 时间**: 20 分钟
- **计算**: 1 × 4 × 1 × 20 = **80 分钟 ≈ 1.3 小时**

**小计（A/B 核心）**: 320 + 280 + 540 + 140 + 80 = **1,360 分钟 ≈ 22.7 小时**

---

### 场景 2：多站模型（C/D 矩阵）

#### 2.1 树模型（C/D）
- **模型数**: 4 个
- **Horizon**: 4 个
- **Matrix Cells**: C, D（2 个）
- **空间参数**: 假设测试 2 个（radius_50km, radius_100km）
- **每个 horizon 时间**: 10 分钟
- **计算**: 4 × 4 × 2 × 2 × 10 = **640 分钟 ≈ 10.7 小时**

#### 2.2 Ensemble（C/D）
- **模型数**: 1 个
- **Horizon**: 4 个
- **Matrix Cells**: C, D（2 个）
- **空间参数**: 2 个
- **每个 horizon 时间**: 35 分钟
- **计算**: 1 × 4 × 2 × 2 × 35 = **560 分钟 ≈ 9.3 小时**

#### 2.3 深度学习模型（C）
- **模型数**: 3 个（LSTM, GRU, TCN）
- **Horizon**: 4 个
- **Matrix Cells**: C（raw track only）
- **空间参数**: 2 个
- **每个 horizon 时间**: 45 分钟
- **计算**: 3 × 4 × 1 × 2 × 45 = **1,080 分钟 ≈ 18 小时**

**小计（C/D 多站）**: 640 + 560 + 1,080 = **2,280 分钟 ≈ 38 小时**

---

### 场景 3：LOSO 评估

LOSO 需要为每个站点重新训练模型，但使用较小的配置（for_loso=True）。

#### 3.1 树模型 LOSO
- **模型数**: 4 个
- **Horizon**: 4 个
- **Matrix Cells**: A, B（2 个）
- **站点数**: 18 个
- **每个 horizon 时间**: 5 分钟（LOSO 配置更快）
- **计算**: 4 × 4 × 2 × 18 × 5 = **2,880 分钟 ≈ 48 小时**

#### 3.2 深度学习模型 LOSO
- **模型数**: 3 个（LSTM, GRU, TCN）
- **Horizon**: 4 个
- **Matrix Cells**: A（raw track only）
- **站点数**: 18 个
- **每个 horizon 时间**: 20 分钟（LOSO 配置更快）
- **计算**: 3 × 4 × 1 × 18 × 20 = **4,320 分钟 ≈ 72 小时**

**小计（LOSO）**: 2,880 + 4,320 = **7,200 分钟 ≈ 120 小时（5 天）**

---

## 🎯 总时间估算

### 完整训练（不含 LOSO）
- **A/B 核心**: 22.7 小时
- **C/D 多站**: 38 小时
- **总计**: **60.7 小时 ≈ 2.5 天**

### 包含 LOSO 评估
- **完整训练**: 60.7 小时
- **LOSO 评估**: 120 小时
- **总计**: **180.7 小时 ≈ 7.5 天**

---

## ⚡ 优化建议

### 1. 并行训练
- **树模型**: 可以并行训练多个模型（CPU 多核）
- **深度学习**: 可以并行训练不同 horizon（如果 GPU 内存足够）
- **预计加速**: 2-4x

### 2. 优先级训练
- **阶段 1（核心）**: A/B 矩阵，单站模型（22.7 小时）
- **阶段 2（扩展）**: C/D 矩阵，多站模型（38 小时）
- **阶段 3（评估）**: LOSO 评估（120 小时）

### 3. 选择性训练
- 只训练关键模型（LightGBM, LSTM, LSTM Multitask）
- 只训练关键 horizon（3h, 12h, 24h）
- **预计时间**: 减少 50-70%

---

## 📝 实际建议

### 最小可行方案（MVP）
- **模型**: LightGBM, LSTM, LSTM Multitask（3 个）
- **Horizon**: 3h, 12h, 24h（3 个）
- **Matrix Cells**: A, B（2 个）
- **时间估算**: 3 × 3 × 2 × 平均 15 分钟 = **270 分钟 ≈ 4.5 小时**

### 完整方案（Full）
- **所有模型**: 10 个
- **所有 Horizon**: 4 个
- **所有 Matrix Cells**: A, B, C, D（4 个）
- **时间估算**: **60.7 小时 ≈ 2.5 天**（不含 LOSO）

### 完整 + LOSO
- **时间估算**: **180.7 小时 ≈ 7.5 天**

---

## ⚠️ 注意事项

1. **实际时间可能因以下因素变化**：
   - 数据量大小
   - GPU/CPU 性能
   - 系统负载
   - 早停触发时间

2. **建议**：
   - 先运行 MVP 方案验证流程
   - 使用并行训练加速
   - 设置合理的早停和检查点
   - 监控训练进度，及时调整

3. **存储空间**：
   - 每个模型约 10-100 MB
   - 完整训练预计需要 5-10 GB 存储空间

---

*最后更新: 2025-11-16*
*基于实际训练日志: `experiments/A/lstm/raw/training_root.log`*

