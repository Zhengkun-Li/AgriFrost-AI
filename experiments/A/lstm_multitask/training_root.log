Output directory: experiments/A/lstm_multitask

CUDA Runtime Info: device=NVIDIA GeForce RTX 5090, cuDNN=91300
================================================================================
üöÄ Training Started
   Start Time: 2025-11-16 22:25:03
   Model Type: lstm_multitask
   Horizons: [3, 6, 12, 24]
   Output Directory: experiments/A/lstm_multitask
================================================================================

============================================================
Step 1: Loading Data
[2025-11-16 22:25:03] Starting data loading...
============================================================
Loading 18 station files from /home/zhengkun-li/frost-risk-forecast-challenge/data/raw/frost-risk-forecast-challenge/stations...
  Loaded 5/18 files...  Loaded 10/18 files...  Loaded 15/18 files...  Loaded 18/18 files...
Combining 18 station DataFrames...
Combined data: 2367360 rows, 26 columns
Stations: 18
Loaded 2367360 rows, 26 columns
Optimizing data types to reduce memory...
Memory usage after optimization: 1.50 GB
[2025-11-16 22:25:06] Step 1 completed in 3.30 seconds

============================================================
Step 2: Cleaning Data
[2025-11-16 22:25:06] Starting data cleaning...
============================================================
After cleaning: 2367360 rows
[2025-11-16 22:25:10] Step 2 completed in 4.06 seconds

============================================================
Step 3: Feature Engineering
[2025-11-16 22:25:10] Starting feature engineering...
============================================================
After feature engineering: 2367360 rows, 293 columns
Optimizing data types after feature engineering...
Memory usage after optimization: 3.84 GB
[2025-11-16 22:25:24] Step 3 completed in 13.19 seconds

============================================================
Step 4: Creating Frost Labels
============================================================
Created frost labels for horizons: [3, 6, 12, 24]
Final dataset: 2367360 rows, 301 columns

Saved labeled data to experiments/A/lstm_multitask/labeled_data.parquet and experiments/A/lstm_multitask/full_training/labeled_data.parquet

[2025-11-16 22:25:39] Starting model training for all horizons...

============================================================
Training models for 3h horizon
[2025-11-16 22:25:39] Starting 3h horizon training...
============================================================
  ‚ö†Ô∏è  Warning: Excluded 12 non-numeric columns: ['Stn Name', 'CIMIS Region', 'qc', 'qc.1', 'qc.2']...
  ‚ö†Ô∏è  Warning: Found 11412 NaN values in features, filled using forward/backward fill
Features: 285, Samples: 2367306
Frost labels: 20579.0 positive (0.87%)
Temperature range: -9.30¬∞C to 45.60¬∞C
Features: 285
Samples: 2367306
Frost events: 20579.0 (0.87%)
Train: 1657114, Val: 355096, Test: 355096

[2025-11-16 22:25:50] Training classification model for frost probability...

  üöÄ Starting LSTM Multi-task training
     Device: cuda
     input_size: 285
     hidden_size: 128
     batch_size: 128
     epochs: 120
     sequence_length: 24

  üöÄ Starting LSTM Multi-Task training
     Device: cuda
     Input size: 285
     Hidden size: 128
     Batch size: 128
     Num workers: 16
     Epochs: 120
     Sequence length: 24
     Total sequences: 1,656,700
     Train sequences: 1,325,360 (10,354 batches)
     Val sequences: 331,340 (2,589 batches)
     Loss weights: temp=1.0, frost=1.0
  Early stopping at epoch 12 (patience=10)
  ‚úÖ Training completed in 268.45 seconds (4.47 minutes)
     Total epochs: 12
  ‚úÖ Probability calibration (platt): Brier 0.002812‚Üí0.002047 (-27.2%), ECE 0.186495‚Üí0.091230 (-51.1%)

[2025-11-16 22:30:26] Multi-task model already trained both temperature and frost prediction tasks together.

[2025-11-16 22:30:26] Evaluating on test set...

Classification Metrics (Frost Probability):
accuracy: 0.9978
brier_score: 0.0017
ece: 0.0008
f1: 0.7969
fn: 410
fp: 354
pr_auc: 0.8763
precision: 0.8090
recall: 0.7852
roc_auc: 0.9975
tn: 352833
tp: 1499

Regression Metrics (Temperature):
mae: 0.7317
mape: 8.54903793334961
r2: 0.9855
rmse: 1.0651
  ‚úÖ Multi-task LSTM model saved to experiments/A/lstm_multitask/full_training/horizon_3h/multitask_model
  ‚úÖ Multi-task LSTM model saved to experiments/A/lstm_multitask/full_training/horizon_3h/frost_classifier
  ‚úÖ Multi-task LSTM model saved to experiments/A/lstm_multitask/full_training/horizon_3h/temp_regressor

Generating reliability diagram...
[2025-11-16 22:33:15] Evaluation completed in 168.58 seconds

[2025-11-16 22:33:15] 3h horizon training completed in 455.74 seconds (7.60 minutes)

============================================================
Training models for 6h horizon
[2025-11-16 22:33:15] Starting 6h horizon training...
============================================================
  ‚ö†Ô∏è  Warning: Excluded 12 non-numeric columns: ['Stn Name', 'CIMIS Region', 'qc', 'qc.1', 'qc.2']...
  ‚ö†Ô∏è  Warning: Found 11250 NaN values in features, filled using forward/backward fill
Features: 285, Samples: 2367252
Frost labels: 20579.0 positive (0.87%)
Temperature range: -9.30¬∞C to 45.60¬∞C
Features: 285
Samples: 2367252
Frost events: 20579.0 (0.87%)
Train: 1657076, Val: 355088, Test: 355088

[2025-11-16 22:33:26] Training classification model for frost probability...

  üöÄ Starting LSTM Multi-task training
     Device: cuda
     input_size: 285
     hidden_size: 128
     batch_size: 128
     epochs: 120
     sequence_length: 48

  üöÄ Starting LSTM Multi-Task training
     Device: cuda
     Input size: 285
     Hidden size: 128
     Batch size: 128
     Num workers: 16
     Epochs: 120
     Sequence length: 48
     Total sequences: 1,656,230
     Train sequences: 1,324,984 (10,351 batches)
     Val sequences: 331,246 (2,588 batches)
     Loss weights: temp=1.0, frost=1.0
  Early stopping at epoch 12 (patience=10)
  ‚úÖ Training completed in 311.89 seconds (5.20 minutes)
     Total epochs: 12
  ‚úÖ Probability calibration (platt): Brier 0.004368‚Üí0.002835 (-35.1%), ECE 0.273882‚Üí0.082748 (-69.8%)

[2025-11-16 22:38:46] Multi-task model already trained both temperature and frost prediction tasks together.

[2025-11-16 22:38:46] Evaluating on test set...

Classification Metrics (Frost Probability):
accuracy: 0.9969
brier_score: 0.0023
ece: 0.0011
f1: 0.7271
fn: 462
fp: 624
pr_auc: 0.7875
precision: 0.6987
recall: 0.7580
roc_auc: 0.9968
tn: 352555
tp: 1447

Regression Metrics (Temperature):
mae: 0.9683
mape: 11.170160293579102
r2: 0.9765
rmse: 1.3574
  ‚úÖ Multi-task LSTM model saved to experiments/A/lstm_multitask/full_training/horizon_6h/multitask_model
  ‚úÖ Multi-task LSTM model saved to experiments/A/lstm_multitask/full_training/horizon_6h/frost_classifier
  ‚úÖ Multi-task LSTM model saved to experiments/A/lstm_multitask/full_training/horizon_6h/temp_regressor

Generating reliability diagram...
[2025-11-16 22:42:39] Evaluation completed in 233.18 seconds

[2025-11-16 22:42:39] 6h horizon training completed in 564.09 seconds (9.40 minutes)

============================================================
Training models for 12h horizon
[2025-11-16 22:42:39] Starting 12h horizon training...
============================================================
  ‚ö†Ô∏è  Warning: Excluded 12 non-numeric columns: ['Stn Name', 'CIMIS Region', 'qc', 'qc.1', 'qc.2']...
  ‚ö†Ô∏è  Warning: Found 11034 NaN values in features, filled using forward/backward fill
Features: 285, Samples: 2367144
Frost labels: 20579.0 positive (0.87%)
Temperature range: -9.30¬∞C to 45.60¬∞C
Features: 285
Samples: 2367144
Frost events: 20579.0 (0.87%)
Train: 1657000, Val: 355072, Test: 355072

[2025-11-16 22:42:50] Training classification model for frost probability...

  üöÄ Starting LSTM Multi-task training
     Device: cuda
     input_size: 285
     hidden_size: 128
     batch_size: 128
     epochs: 120
     sequence_length: 72

  üöÄ Starting LSTM Multi-Task training
     Device: cuda
     Input size: 285
     Hidden size: 128
     Batch size: 128
     Num workers: 16
     Epochs: 120
     Sequence length: 72
     Total sequences: 1,655,722
     Train sequences: 1,324,577 (10,348 batches)
     Val sequences: 331,145 (2,588 batches)
     Loss weights: temp=1.0, frost=1.0
  Early stopping at epoch 13 (patience=10)
  ‚úÖ Training completed in 427.12 seconds (7.12 minutes)
     Total epochs: 13
  ‚úÖ Probability calibration (platt): Brier 0.005308‚Üí0.003732 (-29.7%), ECE 0.266775‚Üí0.086223 (-67.7%)

[2025-11-16 22:50:07] Multi-task model already trained both temperature and frost prediction tasks together.

[2025-11-16 22:50:07] Evaluating on test set...

Classification Metrics (Frost Probability):
accuracy: 0.9952
brier_score: 0.0035
ece: 0.0017
f1: 0.5838
fn: 720
fp: 975
pr_auc: 0.6088
precision: 0.5494
recall: 0.6228
roc_auc: 0.9933
tn: 352188
tp: 1189

Regression Metrics (Temperature):
mae: 1.3711
mape: 15.452131271362305
r2: 0.9557
rmse: 1.8621
  ‚úÖ Multi-task LSTM model saved to experiments/A/lstm_multitask/full_training/horizon_12h/multitask_model
  ‚úÖ Multi-task LSTM model saved to experiments/A/lstm_multitask/full_training/horizon_12h/frost_classifier
  ‚úÖ Multi-task LSTM model saved to experiments/A/lstm_multitask/full_training/horizon_12h/temp_regressor

Generating reliability diagram...
[2025-11-16 22:55:06] Evaluation completed in 299.01 seconds

[2025-11-16 22:55:06] 12h horizon training completed in 746.98 seconds (12.45 minutes)

============================================================
Training models for 24h horizon
[2025-11-16 22:55:06] Starting 24h horizon training...
============================================================
  ‚ö†Ô∏è  Warning: Excluded 12 non-numeric columns: ['Stn Name', 'CIMIS Region', 'qc', 'qc.1', 'qc.2']...
  ‚ö†Ô∏è  Warning: Found 10818 NaN values in features, filled using forward/backward fill
Features: 285, Samples: 2366928
Frost labels: 20579.0 positive (0.87%)
Temperature range: -9.30¬∞C to 45.60¬∞C
Features: 285
Samples: 2366928
Frost events: 20579.0 (0.87%)
Train: 1656849, Val: 355039, Test: 355040

[2025-11-16 22:55:17] Training classification model for frost probability...

  üöÄ Starting LSTM Multi-task training
     Device: cuda
     input_size: 285
     hidden_size: 128
     batch_size: 128
     epochs: 120
     sequence_length: 168

  üöÄ Starting LSTM Multi-Task training
     Device: cuda
     Input size: 285
     Hidden size: 128
     Batch size: 128
     Num workers: 16
     Epochs: 120
     Sequence length: 168
     Total sequences: 1,653,843
     Train sequences: 1,323,074 (10,336 batches)
     Val sequences: 330,769 (2,585 batches)
     Loss weights: temp=1.0, frost=1.0
  Early stopping at epoch 11 (patience=10)
  ‚úÖ Training completed in 798.11 seconds (13.30 minutes)
     Total epochs: 11
  ‚úÖ Probability calibration (platt): Brier 0.008334‚Üí0.005209 (-37.5%), ECE 0.290816‚Üí0.059414 (-79.6%)

[2025-11-16 23:08:53] Multi-task model already trained both temperature and frost prediction tasks together.

[2025-11-16 23:08:53] Evaluating on test set...

Classification Metrics (Frost Probability):
accuracy: 0.9916
brier_score: 0.0055
ece: 0.0037
f1: 0.3396
fn: 1146
fp: 1821
pr_auc: 0.2584
precision: 0.2953
recall: 0.3997
roc_auc: 0.9633
tn: 351310
tp: 763

Regression Metrics (Temperature):
mae: 1.9665
mape: 24.93082618713379
r2: 0.9072
rmse: 2.6943
  ‚úÖ Multi-task LSTM model saved to experiments/A/lstm_multitask/full_training/horizon_24h/multitask_model
  ‚úÖ Multi-task LSTM model saved to experiments/A/lstm_multitask/full_training/horizon_24h/frost_classifier
  ‚úÖ Multi-task LSTM model saved to experiments/A/lstm_multitask/full_training/horizon_24h/temp_regressor

Generating reliability diagram...
[2025-11-16 23:18:04] Evaluation completed in 551.26 seconds

[2025-11-16 23:18:04] 24h horizon training completed in 1377.86 seconds (22.96 minutes)

[2025-11-16 23:18:04] All horizons training completed in 3145.35 seconds (52.42 minutes)

============================================================
Summary Report
============================================================

3h Horizon:
  Frost - Brier: 0.0017, ECE: 0.0008, ROC-AUC: 0.9975
  Temp  - MAE: 0.7317, RMSE: 1.0651, R¬≤: 0.9855

6h Horizon:
  Frost - Brier: 0.0023, ECE: 0.0011, ROC-AUC: 0.9968
  Temp  - MAE: 0.9683, RMSE: 1.3574, R¬≤: 0.9765

12h Horizon:
  Frost - Brier: 0.0035, ECE: 0.0017, ROC-AUC: 0.9933
  Temp  - MAE: 1.3711, RMSE: 1.8621, R¬≤: 0.9557

24h Horizon:
  Frost - Brier: 0.0055, ECE: 0.0037, ROC-AUC: 0.9633
  Temp  - MAE: 1.9665, RMSE: 2.6943, R¬≤: 0.9072

‚úÖ Training completed!
   Start Time: 2025-11-16 22:25:03
   End Time: 2025-11-16 23:18:04
   Duration: 53.02 minutes (0.88 hours)
Results saved to: experiments/A/lstm_multitask
